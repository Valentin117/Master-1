zabbix_export:
  version: '6.0'
  date: '2023-02-24T16:12:45Z'
  groups:
    -
      uuid: 1758bbb5ee2942a1b49597f48125a2fa
      name: Ynov/2023/malval
    -
      uuid: d7add2cc96a64677a7c0c6187879e08e
      name: Ynov/2023/Mod/malval
  templates:
    -
      uuid: 0087a1da1db24ec4a78c30b68eaced39
      template: templateVM
      name: templateVM
      description: |
        Official Linux template. Requires agent of Zabbix 3.0.14, 3.4.5 and 4.0.0 or newer.
        
        Known Issues:
        
          Description: Network discovery. Zabbix agent as of 4.2 doesn't support items such as net.if.status, net.if.speed.
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/387225-discussion-thread-for-official-zabbix-template-for-linux
        
        Template tooling version used: 0.41
      groups:
        -
          name: Ynov/2023/malval
        -
          name: Ynov/2023/Mod/malval
      items:
        -
          uuid: 5ac60cb20a464895978a90ced5a4b7c6
          name: 'Host name of Zabbix agent running'
          key: agent.hostname
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: system
        -
          uuid: a7a38ebcc36e4c38867ab36d3269f299
          name: 'Zabbix agent ping'
          key: agent.ping
          history: 7d
          description: 'The agent always returns 1 for this item. It could be used in combination with nodata() for availability check.'
          valuemap:
            name: 'Zabbix agent ping status'
          tags:
            -
              tag: component
              value: system
        -
          uuid: 46b38e2549ad49319e13880804b25053
          name: 'Version of Zabbix agent running'
          key: agent.version
          delay: 1h
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: application
        -
          uuid: ad6b5f2a991c43edb1ecbedf6254f5b5
          name: 'Maximum number of open file descriptors'
          key: kernel.maxfiles
          delay: 1h
          history: 7d
          description: 'It could be increased by using sysctl utility or modifying file /etc/sysctl.conf.'
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: system
          triggers:
            -
              uuid: c1ac05101b5844e691722e6e4e571e62
              expression: 'last(/templateVM/kernel.maxfiles)<{$KERNEL.MAXFILES.MIN}'
              name: 'Configured max number of open filedescriptors is too low'
              event_name: 'Configured max number of open filedescriptors is too low (< {$KERNEL.MAXFILES.MIN})'
              priority: INFO
              tags:
                -
                  tag: scope
                  value: performance
        -
          uuid: 43993db557524bfeadf3240fdd925385
          name: 'Maximum number of processes'
          key: kernel.maxproc
          delay: 1h
          history: 7d
          description: 'It could be increased by using sysctl utility or modifying file /etc/sysctl.conf.'
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: system
          triggers:
            -
              uuid: 2c2073b3dead4b84a4264c5987d0c737
              expression: 'last(/templateVM/kernel.maxproc)<{$KERNEL.MAXPROC.MIN}'
              name: 'Configured max number of processes is too low'
              event_name: 'Configured max number of processes is too low (< {$KERNEL.MAXPROC.MIN})'
              priority: INFO
              dependencies:
                -
                  name: 'Getting closer to process limit'
                  expression: 'last(/templateVM/proc.num)/last(/templateVM/kernel.maxproc)*100>80'
              tags:
                -
                  tag: scope
                  value: performance
        -
          uuid: 5fa9ce11b7454e4dac99d346797940bc
          name: 'Number of processes'
          key: proc.num
          history: 7d
          tags:
            -
              tag: component
              value: system
        -
          uuid: 59ea5e62ee104a4c8438107a35da86c7
          name: 'Number of running processes'
          key: 'proc.num[,,run]'
          history: 7d
          tags:
            -
              tag: component
              value: system
        -
          uuid: 1b4211719154496b9b520b01ced9b55d
          name: 'Proc Chronyd'
          key: 'proc.num[chronyd]'
          triggers:
            -
              uuid: b787f60343ab4290a027eb7e455d2d8e
              expression: 'last(/templateVM/proc.num[chronyd])=0'
              name: 'Trigger Chronyd Absence'
              priority: AVERAGE
        -
          uuid: 2303d5b9bd4040dd9e0db61a8a29c49e
          name: 'Proc Httpd'
          key: 'proc.num[httpd]'
          triggers:
            -
              uuid: b7404082c7744dd6a2aa5d3082fd878c
              expression: 'last(/templateVM/proc.num[httpd])<>6'
              name: 'Trigger Httpd'
              priority: HIGH
        -
          uuid: 78731fea9bd0423ba0dee907fc97ef71
          name: 'Proc Opaled'
          key: 'proc.num[opaled]'
          triggers:
            -
              uuid: d9cc46e3c78449b4ba013537c4d78b37
              expression: 'last(/templateVM/proc.num[opaled])=0'
              name: 'Trigger Opaled Absence'
              priority: DISASTER
        -
          uuid: 8030e3e007ec423bb6a7f670779a5b1c
          name: 'System boot time'
          key: system.boottime
          delay: 15m
          history: 7d
          units: unixtime
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: component
              value: system
        -
          uuid: 50958d13a0064b91a2222f5601a75a42
          name: 'Interrupts per second'
          key: system.cpu.intr
          history: 7d
          value_type: FLOAT
          preprocessing:
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 1afbeb330862487294f0da9471dd061c
          name: 'Load average (1m avg)'
          key: 'system.cpu.load[all,avg1]'
          history: 7d
          value_type: FLOAT
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 3f9d1cbef2c54c379298d8c30c60fd0d
          name: 'Load average (5m avg)'
          key: 'system.cpu.load[all,avg5]'
          history: 7d
          value_type: FLOAT
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 0631faa3edb54059b185526610b14409
          name: 'Load average (15m avg)'
          key: 'system.cpu.load[all,avg15]'
          history: 7d
          value_type: FLOAT
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: e32170ad83e64073a5ae7abc8f79b40e
          name: 'Number of CPUs'
          key: system.cpu.num
          history: 7d
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: ba719a48a2094be3a9ccf9e59e60c0c0
          name: 'Context switches per second'
          key: system.cpu.switches
          history: 7d
          value_type: FLOAT
          preprocessing:
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 381baf32105a422b98022ecbe8f39b4e
          name: 'CPU utilization'
          type: DEPENDENT
          key: system.cpu.util
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'CPU utilization in %.'
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  //Calculate utilization
                  return (100 - value)
          master_item:
            key: 'system.cpu.util[,idle]'
          tags:
            -
              tag: component
              value: cpu
          triggers:
            -
              uuid: dea9fca74d0e4363b3cc8d9a34707dff
              expression: 'min(/templateVM/system.cpu.util,5m)>{$CPU.UTIL.CRIT}'
              name: 'High CPU utilization'
              event_name: 'High CPU utilization (over {$CPU.UTIL.CRIT}% for 5m)'
              opdata: 'Current utilization: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'CPU utilization is too high. The system might be slow to respond.'
              dependencies:
                -
                  name: 'Load average is too high'
                  expression: |
                    min(/templateVM/system.cpu.load[all,avg1],5m)/last(/templateVM/system.cpu.num)>{$LOAD_AVG_PER_CPU.MAX.WARN}
                    and last(/templateVM/system.cpu.load[all,avg5])>0
                    and last(/templateVM/system.cpu.load[all,avg15])>0
              tags:
                -
                  tag: scope
                  value: performance
        -
          uuid: 77a25189c6344c6597817382da44c4e9
          name: 'CPU guest time'
          key: 'system.cpu.util[,guest]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Guest  time (time  spent  running  a  virtual  CPU  for  a  guest  operating  system).'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: e609e577f27048f0a1166e39118b377b
          name: 'CPU guest nice time'
          key: 'system.cpu.util[,guest_nice]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Time spent running a niced guest (virtual CPU for guest operating systems under the control of the Linux kernel).'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 17d66e993f9f46bda8c56de21c1cbbd7
          name: 'CPU idle time'
          key: 'system.cpu.util[,idle]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent doing nothing.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: b04f0e5b6e3e4006933355630187e5f4
          name: 'CPU interrupt time'
          key: 'system.cpu.util[,interrupt]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of time the CPU has been servicing hardware interrupts.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 9ddb5d00b91747e4b8a6aad6855ef0c8
          name: 'CPU iowait time'
          key: 'system.cpu.util[,iowait]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Amount of time the CPU has been waiting for I/O to complete.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 495b481409e8468fa6f4123d246cbadb
          name: 'CPU nice time'
          key: 'system.cpu.util[,nice]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent running users'' processes that have been niced.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 411a80cd6af34b1ba08554469587823f
          name: 'CPU softirq time'
          key: 'system.cpu.util[,softirq]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of time the CPU has been servicing software interrupts.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 2d6fccc2532d4604bddfb37e8cc2f5cb
          name: 'CPU steal time'
          key: 'system.cpu.util[,steal]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The amount of CPU ''stolen'' from this virtual machine by the hypervisor for other tasks (such as running another virtual machine).'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: be23cce3b5604c70b49c38d84f02d81c
          name: 'CPU system time'
          key: 'system.cpu.util[,system]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent running the kernel and its processes.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: b33a7fd45e9c414aaf0d0fbdcae69055
          name: 'CPU user time'
          key: 'system.cpu.util[,user]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The time the CPU has spent running users'' processes that are not niced.'
          tags:
            -
              tag: component
              value: cpu
        -
          uuid: 8d46f6fc2c0141c8a0438a8e9efdaee0
          name: 'System name'
          key: system.hostname
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: 'System host name.'
          inventory_link: NAME
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            -
              tag: component
              value: system
          triggers:
            -
              uuid: c221842d33ae400b895ef21ac858794f
              expression: 'last(/templateVM/system.hostname,#1)<>last(/templateVM/system.hostname,#2) and length(last(/templateVM/system.hostname))>0'
              name: 'System name has changed'
              event_name: 'System name has changed (new name: {ITEM.VALUE})'
              priority: INFO
              description: 'System name has changed. Ack to close.'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
                -
                  tag: scope
                  value: security
        -
          uuid: 2e09134acf334eb58e9fa7a127fa5c8a
          name: 'System local time'
          key: system.localtime
          history: 7d
          units: unixtime
          description: 'System local time of the host.'
          tags:
            -
              tag: component
              value: system
          triggers:
            -
              uuid: a847d3ec2eb240a78bd7f2e204986d1a
              expression: 'fuzzytime(/templateVM/system.localtime,{$SYSTEM.FUZZYTIME.MAX})=0'
              name: 'System time is out of sync'
              event_name: 'System time is out of sync (diff with Zabbix server > {$SYSTEM.FUZZYTIME.MAX}s)'
              priority: WARNING
              description: 'The host system time is different from the Zabbix server time.'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: availability
                -
                  tag: scope
                  value: performance
        -
          uuid: 6e8edd73f7584f0fbf480a028ae5ae64
          name: 'Operating system architecture'
          key: system.sw.arch
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: 'Operating system architecture of the host.'
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: os
        -
          uuid: 33311b4e763e43a6b6ca06f79848a5c8
          name: 'Operating system'
          key: system.sw.os
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          inventory_link: OS
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: os
          triggers:
            -
              uuid: 0433da01de5b47dc9cec1b8f5b2c3a46
              expression: 'last(/templateVM/system.sw.os,#1)<>last(/templateVM/system.sw.os,#2) and length(last(/templateVM/system.sw.os))>0'
              name: 'Operating system description has changed'
              priority: INFO
              description: 'Operating system description has changed. Possible reasons that system has been updated or replaced. Ack to close.'
              manual_close: 'YES'
              dependencies:
                -
                  name: 'System name has changed'
                  expression: 'last(/templateVM/system.hostname,#1)<>last(/templateVM/system.hostname,#2) and length(last(/templateVM/system.hostname))>0'
              tags:
                -
                  tag: scope
                  value: notice
        -
          uuid: 94e03a7f3a824cd1b2a6e6ff1581adf9
          name: 'Software installed'
          key: system.sw.packages
          delay: 1h
          history: 2w
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: component
              value: os
        -
          uuid: 49b09460c8254f3db10c076fce170412
          name: 'Free swap space'
          key: 'system.swap.size[,free]'
          history: 7d
          units: B
          description: 'The free space of swap volume/file in bytes.'
          tags:
            -
              tag: component
              value: memory
            -
              tag: component
              value: storage
        -
          uuid: 0adc11f6593944829cf0b8ac4c62a9b1
          name: 'Free swap space in %'
          key: 'system.swap.size[,pfree]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'The free space of swap volume/file in percent.'
          tags:
            -
              tag: component
              value: memory
            -
              tag: component
              value: storage
        -
          uuid: 6151c912d72c40f082b84edea3262f04
          name: 'Total swap space'
          key: 'system.swap.size[,total]'
          history: 7d
          units: B
          description: 'The total space of swap volume/file in bytes.'
          tags:
            -
              tag: component
              value: memory
            -
              tag: component
              value: storage
        -
          uuid: 02dd99375eb2484aaac1e013639b98ec
          name: 'System description'
          key: system.uname
          delay: 15m
          history: 2w
          trends: '0'
          value_type: CHAR
          description: 'The information as normally returned by ''uname -a''.'
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            -
              tag: component
              value: system
        -
          uuid: 2aea1b54b4f945c99f8838641cb45183
          name: 'System uptime'
          key: system.uptime
          delay: 30s
          history: 2w
          trends: 0d
          units: uptime
          description: 'System uptime in ''N days, hh:mm:ss'' format.'
          tags:
            -
              tag: component
              value: system
          triggers:
            -
              uuid: bb960906fd994d79ae40137a0ea238dd
              expression: last(/templateVM/system.uptime)<10m
              name: 'has been restarted'
              event_name: '{HOST.NAME} has been restarted (uptime < 10m)'
              priority: WARNING
              description: 'The host uptime is less than 10 minutes'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
        -
          uuid: 24fb63e68bee4426923e2878eb784f64
          name: 'Number of logged in users'
          key: system.users.num
          history: 7d
          description: 'Number of users who are currently logged in.'
          tags:
            -
              tag: component
              value: environment
        -
          uuid: 318713ecd82b410f9de6b673e9b93dd5
          name: 'Checksum of /etc/passwd'
          key: 'vfs.file.cksum[/etc/passwd,sha256]'
          delay: 15m
          history: 7d
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: component
              value: environment
          triggers:
            -
              uuid: 45bbb5d8d54f40e1b2c5dddceb51457d
              expression: 'last(/templateVM/vfs.file.cksum[/etc/passwd,sha256],#1)<>last(/templateVM/vfs.file.cksum[/etc/passwd,sha256],#2)'
              name: '/etc/passwd has been changed'
              priority: INFO
              manual_close: 'YES'
              dependencies:
                -
                  name: 'Operating system description has changed'
                  expression: 'last(/templateVM/system.sw.os,#1)<>last(/templateVM/system.sw.os,#2) and length(last(/templateVM/system.sw.os))>0'
                -
                  name: 'System name has changed'
                  expression: 'last(/templateVM/system.hostname,#1)<>last(/templateVM/system.hostname,#2) and length(last(/templateVM/system.hostname))>0'
              tags:
                -
                  tag: scope
                  value: security
        -
          uuid: 84a88eb25f0f48fab0dea71f0c3c7973
          name: 'Taille fichiers applicatifs'
          key: 'vfs.file.size[/var/log/opale/cosform*.log]'
        -
          uuid: 54ebbf78691c4da19f1485c6ffa9d335
          name: 'Disk utilization'
          key: vfs.fs.util
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Available disk space as percentage of total. See also Appendixes in Zabbix Documentation about parameters of the vm.disk.size item.'
          tags:
            -
              tag: component
              value: disk
        -
          uuid: fa7ccf1e264741ea8897ec22929ffd4e
          name: 'Available memory'
          key: 'vm.memory.size[available]'
          history: 7d
          units: B
          description: 'Available memory, in Linux, available = free + buffers + cache. On other platforms calculation may vary. See also Appendixes in Zabbix Documentation about parameters of the vm.memory.size item.'
          tags:
            -
              tag: component
              value: memory
        -
          uuid: 68f56a056647440c9c191f80ef937504
          name: 'Available memory in %'
          key: 'vm.memory.size[pavailable]'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Available memory as percentage of total. See also Appendixes in Zabbix Documentation about parameters of the vm.memory.size item.'
          tags:
            -
              tag: component
              value: memory
        -
          uuid: f3bfe32df2d8424eb4d9f7653f30c653
          name: 'Total memory'
          key: 'vm.memory.size[total]'
          history: 7d
          units: B
          description: 'Total memory in Bytes.'
          tags:
            -
              tag: component
              value: memory
        -
          uuid: 253f917494794beaaf89a3499888c56e
          name: 'Memory utilization'
          type: DEPENDENT
          key: vm.memory.utilization
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Memory used percentage is calculated as (100-pavailable)'
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - 'return (100-value);'
          master_item:
            key: 'vm.memory.size[pavailable]'
          tags:
            -
              tag: component
              value: memory
          triggers:
            -
              uuid: 435d6f005f2a4d27b64031f7c6547e93
              expression: 'min(/templateVM/vm.memory.utilization,5m)>{$MEMORY.UTIL.MAX}'
              name: 'High memory utilization'
              event_name: 'High memory utilization (>{$MEMORY.UTIL.MAX}% for 5m)'
              priority: AVERAGE
              description: 'The system is running out of free memory.'
              dependencies:
                -
                  name: 'Lack of available memory'
                  expression: 'max(/templateVM/vm.memory.size[available],5m)<{$MEMORY.AVAILABLE.MIN} and last(/templateVM/vm.memory.size[total])>0'
              tags:
                -
                  tag: scope
                  value: capacity
                -
                  tag: scope
                  value: performance
        -
          uuid: bc0a0c695a0148e4b8b0bb0ae692aa4b
          name: 'Zabbix agent availability'
          type: INTERNAL
          key: 'zabbix[host,agent,available]'
          history: 7d
          description: 'Monitoring agent availability status'
          valuemap:
            name: zabbix.host.available
          tags:
            -
              tag: component
              value: system
          triggers:
            -
              uuid: 86e096334834473bbe63711b21b99c19
              expression: 'max(/templateVM/zabbix[host,agent,available],{$AGENT.TIMEOUT})=0'
              name: 'Zabbix agent is not available'
              event_name: 'Zabbix agent is not available (for {$AGENT.TIMEOUT})'
              priority: AVERAGE
              description: 'For passive only agents, host availability is used with {$AGENT.TIMEOUT} as time threshold.'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: availability
      discovery_rules:
        -
          uuid: 754eda6a0a984d34a58fb152081cc440
          name: 'Network interface discovery'
          key: net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.MATCHES}'
                formulaid: A
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          description: 'Discovery of network interfaces.'
          item_prototypes:
            -
              uuid: f403cd61921346c7ad6cc7cb7d84ddc8
              name: 'Interface {#IFNAME}: Inbound packets discarded'
              key: 'net.if.in["{#IFNAME}",dropped]'
              delay: 3m
              history: 7d
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 118ebefad0ab42f1941baad499e7b440
              name: 'Interface {#IFNAME}: Inbound packets with errors'
              key: 'net.if.in["{#IFNAME}",errors]'
              delay: 3m
              history: 7d
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: bcd1ad19524c4840899b239e567395ef
              name: 'Interface {#IFNAME}: Bits received'
              key: 'net.if.in["{#IFNAME}"]'
              delay: 3m
              history: 7d
              units: bps
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: b53a14c2c2cd4f788be130d44d3c2b8e
              name: 'Interface {#IFNAME}: Outbound packets discarded'
              key: 'net.if.out["{#IFNAME}",dropped]'
              delay: 3m
              history: 7d
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: c8c4196479e9407191aa83132e0b436f
              name: 'Interface {#IFNAME}: Outbound packets with errors'
              key: 'net.if.out["{#IFNAME}",errors]'
              delay: 3m
              history: 7d
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 1b4c66d661f746f3929eea468ae84d9d
              name: 'Interface {#IFNAME}: Bits sent'
              key: 'net.if.out["{#IFNAME}"]'
              delay: 3m
              history: 7d
              units: bps
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 3f3cead5244b46e8bdc12d00aa56b780
              name: 'Interface {#IFNAME}: Operational status'
              key: 'vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"]'
              history: 7d
              trends: '0'
              description: 'Reference: https://www.kernel.org/doc/Documentation/networking/operstates.txt'
              valuemap:
                name: ifOperStatus
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var newvalue;
                      switch(value) {
                        case "unknown":
                          newvalue = 0;
                          break;
                        case "notpresent":
                          newvalue = 1;
                          break;
                        case "down":
                          newvalue = 2;
                          break;
                        case "lowerlayerdown":
                          newvalue = 3;
                          break;
                        case "testing":
                          newvalue = 4;
                          break;
                        case "dormant":
                          newvalue = 5;
                          break;
                        case "up":
                          newvalue = 6;
                          break;  default:
                          newvalue = "Problem parsing interface operstate in JS";
                      }
                      return newvalue;
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
              trigger_prototypes:
                -
                  uuid: 9fb3926e9af74eb68a3b8b73dea3845f
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
                  name: 'Interface {#IFNAME}: Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    This trigger expression works as follows:
                    1. Can be triggered if operations status is down.
                    2. {$IFCONTROL:"{#IFNAME}"}=1 - user can redefine Context macro to value - 0. That marks this interface as not important. No new trigger will be fired if this interface is down.
                    3. {TEMPLATE_NAME:METRIC.diff()}=1) - trigger fires only if operational status was up(1) sometime before. (So, do not fire 'ethernal off' interfaces.)
                    
                    WARNING: if closed manually - won't fire again on next poll, because of .diff.
                  tags:
                    -
                      tag: scope
                      value: availability
            -
              uuid: cf604cf1937244a6a8bf59e1c9a66259
              name: 'Interface {#IFNAME}: Speed'
              key: 'vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]'
              delay: 5m
              history: 7d
              trends: 0d
              units: bps
              description: |
                Indicates the interface latest or current speed value. Value is an integer representing the link speed in bits/sec.
                This attribute is only valid for interfaces that implement the ethtool get_link_ksettings method (mostly Ethernet).
                Reference: https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-net
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '1000000'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 9275050b05db4283ad32c4154ac3e676
              name: 'Interface {#IFNAME}: Interface type'
              key: 'vfs.file.contents["/sys/class/net/{#IFNAME}/type"]'
              delay: 1h
              history: 7d
              trends: 0d
              description: |
                Indicates the interface protocol type as a decimal value.
                See include/uapi/linux/if_arp.h for all possible values.
                Reference: https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-net
              valuemap:
                name: 'Linux::Interface protocol types'
              preprocessing:
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: interface
                  value: '{#IFNAME}'
          trigger_prototypes:
            -
              uuid: ebe1fbf49f48453bb0e47df364c11c99
              expression: |
                change(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])<0 and last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])>0
                and
                (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/type"])=6 or last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/type"])=1)
                and
                (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                (change(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])>0 and last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"],#2)>0) or
                (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2)
              name: 'Interface {#IFNAME}: Ethernet has changed to lower speed than it was before'
              opdata: 'Current reported speed: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'This Ethernet connection has transitioned down from its known maximum speed. This might be a sign of autonegotiation issues. Ack to close.'
              dependencies:
                -
                  name: 'Interface {#IFNAME}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_expression: 'last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                -
                  tag: scope
                  value: performance
            -
              uuid: ff059e11b0dc457ba428c835c47fec94
              expression: |
                (avg(/templateVM/net.if.in["{#IFNAME}"],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]) or
                avg(/templateVM/net.if.out["{#IFNAME}"],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])) and
                last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/templateVM/net.if.in["{#IFNAME}"],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]) and
                avg(/templateVM/net.if.out["{#IFNAME}"],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/speed"])
              name: 'Interface {#IFNAME}: High bandwidth usage'
              event_name: 'Interface {#IFNAME}: High bandwidth usage (>{$IF.UTIL.MAX:"{#IFNAME}"}%)'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'The network interface utilization is close to its estimated maximum bandwidth.'
              dependencies:
                -
                  name: 'Interface {#IFNAME}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_expression: 'last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                -
                  tag: scope
                  value: performance
            -
              uuid: 69deb7e35fb04fabbf153a852096f59f
              expression: |
                min(/templateVM/net.if.in["{#IFNAME}",errors],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
                or min(/templateVM/net.if.out["{#IFNAME}",errors],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                max(/templateVM/net.if.in["{#IFNAME}",errors],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
                and max(/templateVM/net.if.out["{#IFNAME}",errors],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFNAME}: High error rate'
              event_name: 'Interface {#IFNAME}: High error rate (>{$IF.ERRORS.WARN:"{#IFNAME}"} for 5m)'
              opdata: 'errors in: {ITEM.LASTVALUE1}, errors out: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'Recovers when below 80% of {$IF.ERRORS.WARN:"{#IFNAME}"} threshold'
              dependencies:
                -
                  name: 'Interface {#IFNAME}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2))'
                  recovery_expression: 'last(/templateVM/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                -
                  tag: scope
                  value: availability
                -
                  tag: scope
                  value: performance
          graph_prototypes:
            -
              uuid: 4926b3a73920485093f79fa93b1b88c8
              name: 'Interface {#IFNAME}: Network traffic'
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: templateVM
                    key: 'net.if.in["{#IFNAME}"]'
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 2774A4
                  item:
                    host: templateVM
                    key: 'net.if.out["{#IFNAME}"]'
                -
                  sortorder: '2'
                  color: F63100
                  yaxisside: RIGHT
                  item:
                    host: templateVM
                    key: 'net.if.out["{#IFNAME}",errors]'
                -
                  sortorder: '3'
                  color: A54F10
                  yaxisside: RIGHT
                  item:
                    host: templateVM
                    key: 'net.if.in["{#IFNAME}",errors]'
                -
                  sortorder: '4'
                  color: FC6EA3
                  yaxisside: RIGHT
                  item:
                    host: templateVM
                    key: 'net.if.out["{#IFNAME}",dropped]'
                -
                  sortorder: '5'
                  color: 6C59DC
                  yaxisside: RIGHT
                  item:
                    host: templateVM
                    key: 'net.if.in["{#IFNAME}",dropped]'
        -
          uuid: 9e3414137a7045dabe016d7992b04bc1
          name: 'Block devices discovery'
          key: vfs.dev.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#DEVTYPE}'
                value: disk
                formulaid: C
              -
                macro: '{#DEVNAME}'
                value: '{$VFS.DEV.DEVNAME.MATCHES}'
                formulaid: B
              -
                macro: '{#DEVNAME}'
                value: '{$VFS.DEV.DEVNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: A
          item_prototypes:
            -
              uuid: c0c8cda507504081b17af195b6bb0cac
              name: '{#DEVNAME}: Disk average queue size (avgqu-sz)'
              type: DEPENDENT
              key: 'vfs.dev.queue_size[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'Current average disk queue, the number of requests outstanding on the disk at the time the performance data is collected.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[10]'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.001'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: aa191b619b8949c1b344a3089b3e247e
              name: '{#DEVNAME}: Disk read request avg waiting time (r_await)'
              type: CALCULATED
              key: 'vfs.dev.read.await[{#DEVNAME}]'
              history: 7d
              value_type: FLOAT
              units: '!ms'
              params: '(last(//vfs.dev.read.time.rate[{#DEVNAME}])/(last(//vfs.dev.read.rate[{#DEVNAME}])+(last(//vfs.dev.read.rate[{#DEVNAME}])=0)))*1000*(last(//vfs.dev.read.rate[{#DEVNAME}]) > 0)'
              description: 'This formula contains two boolean expressions that evaluates to 1 or 0 in order to set calculated metric to zero and to avoid division by zero exception.'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: 3c7801adef444fc282707cd135848fe0
              name: '{#DEVNAME}: Disk read rate'
              type: DEPENDENT
              key: 'vfs.dev.read.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '!r/s'
              description: 'r/s. The number (after merges) of read requests completed per second for the device.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[0]'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: 2ee20fd9f9be48c6af931bb3dd10ef8b
              name: '{#DEVNAME}: Disk read time (rate)'
              type: DEPENDENT
              key: 'vfs.dev.read.time.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'Rate of total read time counter. Used in r_await calculation'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[3]'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.001'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: d0222ed2c8a14fc8bcf8d75a51ff1029
              name: '{#DEVNAME}: Disk utilization'
              type: DEPENDENT
              key: 'vfs.dev.util[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '%'
              description: 'This item is the percentage of elapsed time that the selected disk drive was busy servicing read or writes requests.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[9]'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.1'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: 625b3d20e6de4b3796d56f5324cbfd83
              name: '{#DEVNAME}: Disk write request avg waiting time (w_await)'
              type: CALCULATED
              key: 'vfs.dev.write.await[{#DEVNAME}]'
              history: 7d
              value_type: FLOAT
              units: '!ms'
              params: '(last(//vfs.dev.write.time.rate[{#DEVNAME}])/(last(//vfs.dev.write.rate[{#DEVNAME}])+(last(//vfs.dev.write.rate[{#DEVNAME}])=0)))*1000*(last(//vfs.dev.write.rate[{#DEVNAME}]) > 0)'
              description: 'This formula contains two boolean expressions that evaluates to 1 or 0 in order to set calculated metric to zero and to avoid division by zero exception.'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: 940d908476124d7db6394af788dc1c2b
              name: '{#DEVNAME}: Disk write rate'
              type: DEPENDENT
              key: 'vfs.dev.write.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '!w/s'
              description: 'w/s. The number (after merges) of write requests completed per second for the device.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[4]'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: 24f3ad74002648569475d8e8dd8087d5
              name: '{#DEVNAME}: Disk write time (rate)'
              type: DEPENDENT
              key: 'vfs.dev.write.time.rate[{#DEVNAME}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'Rate of total write time counter. Used in w_await calculation'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[7]'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.001'
              master_item:
                key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: disk
                  value: '{#DEVNAME}'
            -
              uuid: 53bdd6515ddd404ebec0c8c2f7de73a1
              name: '{#DEVNAME}: Get stats'
              key: 'vfs.file.contents[/sys/block/{#DEVNAME}/stat]'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'Get contents of /sys/block/{#DEVNAME}/stat for disk stats.'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - 'return JSON.stringify(value.trim().split(/ +/));'
              tags:
                -
                  tag: component
                  value: raw
          trigger_prototypes:
            -
              uuid: 479fb01d422c4c45a2dee4e7f0574d6a
              expression: 'min(/templateVM/vfs.dev.read.await[{#DEVNAME}],15m) > {$VFS.DEV.READ.AWAIT.WARN:"{#DEVNAME}"} or min(/templateVM/vfs.dev.write.await[{#DEVNAME}],15m) > {$VFS.DEV.WRITE.AWAIT.WARN:"{#DEVNAME}"}'
              name: '{#DEVNAME}: Disk read/write request responses are too high'
              event_name: '{#DEVNAME}: Disk read/write request responses are too high (read > {$VFS.DEV.READ.AWAIT.WARN:"{#DEVNAME}"} ms for 15m or write > {$VFS.DEV.WRITE.AWAIT.WARN:"{#DEVNAME}"} ms for 15m)'
              priority: WARNING
              description: 'This trigger might indicate disk {#DEVNAME} saturation.'
              tags:
                -
                  tag: scope
                  value: performance
          graph_prototypes:
            -
              uuid: ceee4028d53545878eb8e4b7d73f098d
              name: '{#DEVNAME}: Disk average waiting time'
              graph_items:
                -
                  color: 1A7C11
                  item:
                    host: templateVM
                    key: 'vfs.dev.read.await[{#DEVNAME}]'
                -
                  sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 2774A4
                  item:
                    host: templateVM
                    key: 'vfs.dev.write.await[{#DEVNAME}]'
            -
              uuid: f6c3a6b8f4d642a58c6f0e75e19b608d
              name: '{#DEVNAME}: Disk read/write rates'
              graph_items:
                -
                  color: 1A7C11
                  item:
                    host: templateVM
                    key: 'vfs.dev.read.rate[{#DEVNAME}]'
                -
                  sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 2774A4
                  item:
                    host: templateVM
                    key: 'vfs.dev.write.rate[{#DEVNAME}]'
            -
              uuid: f42fe83aabd8465f8d33753180b6166d
              name: '{#DEVNAME}: Disk utilization and queue'
              graph_items:
                -
                  color: 1A7C11
                  yaxisside: RIGHT
                  item:
                    host: templateVM
                    key: 'vfs.dev.queue_size[{#DEVNAME}]'
                -
                  sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 2774A4
                  item:
                    host: templateVM
                    key: 'vfs.dev.util[{#DEVNAME}]'
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        -
          uuid: 0361964379184fd39cdc5fcabf01ff47
          name: 'Mounted filesystem discovery'
          key: vfs.fs.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.MATCHES}'
                formulaid: C
              -
                macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              -
                macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.MATCHES}'
                formulaid: A
              -
                macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          description: 'Discovery of file systems of different types.'
          item_prototypes:
            -
              uuid: 2faae316c10e4bb6b11e6e00cc375fd4
              name: '{#FSNAME}: Free inodes in %'
              key: 'vfs.fs.inode[{#FSNAME},pfree]'
              history: 7d
              value_type: FLOAT
              units: '%'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: filesystem
                  value: '{#FSNAME}'
              trigger_prototypes:
                -
                  uuid: ab5601ead40940738fb5853c53b4c56c
                  expression: 'min(/templateVM/vfs.fs.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  name: '{#FSNAME}: Running out of free inodes'
                  event_name: '{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    It may become impossible to write to disk if there are no index nodes left.
                    As symptoms, 'No space left on device' or 'Disk is full' errors may be seen even though free space is available.
                  tags:
                    -
                      tag: scope
                      value: capacity
                    -
                      tag: scope
                      value: performance
                -
                  uuid: e127094781ae41969d38e909a8efd40b
                  expression: 'min(/templateVM/vfs.fs.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}'
                  name: '{#FSNAME}: Running out of free inodes'
                  event_name: '{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    It may become impossible to write to disk if there are no index nodes left.
                    As symptoms, 'No space left on device' or 'Disk is full' errors may be seen even though free space is available.
                  dependencies:
                    -
                      name: '{#FSNAME}: Running out of free inodes'
                      expression: 'min(/templateVM/vfs.fs.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  tags:
                    -
                      tag: scope
                      value: capacity
                    -
                      tag: scope
                      value: performance
            -
              uuid: 7157eaa588bb464a9170ef366b2a6783
              name: '{#FSNAME}: Space utilization'
              key: 'vfs.fs.size[{#FSNAME},pused]'
              history: 7d
              value_type: FLOAT
              units: '%'
              description: 'Space utilization in % for {#FSNAME}'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: filesystem
                  value: '{#FSNAME}'
            -
              uuid: 6b31cd5fa6d3463480557a2269c61aad
              name: '{#FSNAME}: Total space'
              key: 'vfs.fs.size[{#FSNAME},total]'
              history: 7d
              units: B
              description: 'Total space in Bytes'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: filesystem
                  value: '{#FSNAME}'
            -
              uuid: 881bd82847264b1b94dc304b7f05ba99
              name: '{#FSNAME}: Used space'
              key: 'vfs.fs.size[{#FSNAME},used]'
              history: 7d
              units: B
              description: 'Used storage in Bytes'
              tags:
                -
                  tag: component
                  value: storage
                -
                  tag: filesystem
                  value: '{#FSNAME}'
          trigger_prototypes:
            -
              uuid: 25bc95c9481f440b86443a5fdd3f7c0e
              expression: |
                last(/templateVM/vfs.fs.size[{#FSNAME},pused])>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"} and
                ((last(/templateVM/vfs.fs.size[{#FSNAME},total])-last(/templateVM/vfs.fs.size[{#FSNAME},used]))<{$VFS.FS.FREE.MIN.CRIT:"{#FSNAME}"} or timeleft(/templateVM/vfs.fs.size[{#FSNAME},pused],1h,100)<1d)
              name: '{#FSNAME}: Disk space is critically low'
              event_name: '{#FSNAME}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%)'
              opdata: 'Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})'
              priority: AVERAGE
              description: |
                Two conditions should match: First, space utilization should be above {$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}.
                 Second condition should be one of the following:
                 - The disk free space is less than {$VFS.FS.FREE.MIN.CRIT:"{#FSNAME}"}.
                 - The disk will be full in less than 24 hours.
              tags:
                -
                  tag: scope
                  value: availability
                -
                  tag: scope
                  value: capacity
            -
              uuid: fe5dc120116d4c34b2363e95c61f53c6
              expression: |
                last(/templateVM/vfs.fs.size[{#FSNAME},pused])>{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"} and
                ((last(/templateVM/vfs.fs.size[{#FSNAME},total])-last(/templateVM/vfs.fs.size[{#FSNAME},used]))<{$VFS.FS.FREE.MIN.WARN:"{#FSNAME}"} or timeleft(/templateVM/vfs.fs.size[{#FSNAME},pused],1h,100)<1d)
              name: '{#FSNAME}: Disk space is low'
              event_name: '{#FSNAME}: Disk space is low (used > {$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%)'
              opdata: 'Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})'
              priority: WARNING
              description: |
                Two conditions should match: First, space utilization should be above {$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}.
                 Second condition should be one of the following:
                 - The disk free space is less than {$VFS.FS.FREE.MIN.WARN:"{#FSNAME}"}.
                 - The disk will be full in less than 24 hours.
              dependencies:
                -
                  name: '{#FSNAME}: Disk space is critically low'
                  expression: |
                    last(/templateVM/vfs.fs.size[{#FSNAME},pused])>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"} and
                    ((last(/templateVM/vfs.fs.size[{#FSNAME},total])-last(/templateVM/vfs.fs.size[{#FSNAME},used]))<{$VFS.FS.FREE.MIN.CRIT:"{#FSNAME}"} or timeleft(/templateVM/vfs.fs.size[{#FSNAME},pused],1h,100)<1d)
              tags:
                -
                  tag: scope
                  value: availability
                -
                  tag: scope
                  value: capacity
          graph_prototypes:
            -
              uuid: dd0d120b72b0493f884ecdf4f13fe84b
              name: '{#FSNAME}: Disk space usage'
              width: '600'
              height: '340'
              type: PIE
              show_3d: 'YES'
              graph_items:
                -
                  color: '969696'
                  calc_fnc: LAST
                  type: GRAPH_SUM
                  item:
                    host: templateVM
                    key: 'vfs.fs.size[{#FSNAME},total]'
                -
                  sortorder: '1'
                  color: C80000
                  calc_fnc: LAST
                  item:
                    host: templateVM
                    key: 'vfs.fs.size[{#FSNAME},used]'
      tags:
        -
          tag: class
          value: os
        -
          tag: target
          value: linux
      macros:
        -
          macro: '{$AGENT.TIMEOUT}'
          value: 3m
          description: 'Timeout after which agent is considered unavailable. Works only for agents reachable from Zabbix server/proxy (passive mode).'
        -
          macro: '{$CPU.UTIL.CRIT}'
          value: '90'
        -
          macro: '{$IF.ERRORS.WARN}'
          value: '2'
        -
          macro: '{$IF.UTIL.MAX}'
          value: '90'
          description: 'This macro is used as a threshold in interface utilization trigger.'
        -
          macro: '{$IFCONTROL}'
          value: '1'
        -
          macro: '{$KERNEL.MAXFILES.MIN}'
          value: '256'
        -
          macro: '{$KERNEL.MAXPROC.MIN}'
          value: '1024'
        -
          macro: '{$LOAD_AVG_PER_CPU.MAX.WARN}'
          value: '1.5'
          description: 'Load per CPU considered sustainable. Tune if needed.'
        -
          macro: '{$MEMORY.AVAILABLE.MIN}'
          value: 20M
          description: 'This macro is used as a threshold in memory available trigger.'
        -
          macro: '{$MEMORY.UTIL.MAX}'
          value: '90'
          description: 'This macro is used as a threshold in memory utilization trigger.'
        -
          macro: '{$NET.IF.IFNAME.MATCHES}'
          value: '^.*$'
        -
          macro: '{$NET.IF.IFNAME.NOT_MATCHES}'
          value: '(^Software Loopback Interface|^NULL[0-9.]*$|^[Ll]o[0-9.]*$|^[Ss]ystem$|^Nu[0-9.]*$|^veth[0-9A-z]+$|docker[0-9]+|br-[a-z0-9]{12})'
          description: 'Filter out loopbacks, nulls, docker veth links and docker0 bridge by default'
        -
          macro: '{$SWAP.PFREE.MIN.WARN}'
          value: '50'
        -
          macro: '{$SYSTEM.FUZZYTIME.MAX}'
          value: '60'
        -
          macro: '{$VFS.DEV.DEVNAME.MATCHES}'
          value: .+
          description: 'This macro is used in block devices discovery. Can be overridden on the host or linked template level'
        -
          macro: '{$VFS.DEV.DEVNAME.NOT_MATCHES}'
          value: '^(loop[0-9]*|sd[a-z][0-9]+|nbd[0-9]+|sr[0-9]+|fd[0-9]+|dm-[0-9]+|ram[0-9]+|ploop[a-z0-9]+|md[0-9]*|hcp[0-9]*|zram[0-9]*)'
          description: 'This macro is used in block devices discovery. Can be overridden on the host or linked template level'
        -
          macro: '{$VFS.DEV.READ.AWAIT.WARN}'
          value: '20'
          description: 'Disk read average response time (in ms) before the trigger would fire'
        -
          macro: '{$VFS.DEV.WRITE.AWAIT.WARN}'
          value: '20'
          description: 'Disk write average response time (in ms) before the trigger would fire'
        -
          macro: '{$VFS.FS.FREE.MIN.CRIT}'
          value: 5G
          description: 'The critical threshold of the filesystem utilization.'
        -
          macro: '{$VFS.FS.FREE.MIN.WARN}'
          value: 10G
          description: 'The warning threshold of the filesystem utilization.'
        -
          macro: '{$VFS.FS.FSNAME.MATCHES}'
          value: .+
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        -
          macro: '{$VFS.FS.FSNAME.NOT_MATCHES}'
          value: ^(/dev|/sys|/run|/proc|.+/shm$)
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        -
          macro: '{$VFS.FS.FSTYPE.MATCHES}'
          value: ^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        -
          macro: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
          value: ^\s$
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        -
          macro: '{$VFS.FS.INODE.PFREE.MIN.CRIT}'
          value: '10'
        -
          macro: '{$VFS.FS.INODE.PFREE.MIN.WARN}'
          value: '20'
        -
          macro: '{$VFS.FS.PUSED.MAX.CRIT}'
          value: '90'
        -
          macro: '{$VFS.FS.PUSED.MAX.WARN}'
          value: '80'
      dashboards:
        -
          uuid: ae2efa73d0d942deaf71ddb5679dd166
          name: 'Network interfaces'
          pages:
            -
              widgets:
                -
                  type: GRAPH_PROTOTYPE
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: templateVM
                        name: 'Interface {#IFNAME}: Network traffic'
        -
          uuid: 485752d596ab4539b2cb8dac4aa48709
          name: 'System performance'
          pages:
            -
              widgets:
                -
                  type: GRAPH_CLASSIC
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '0'
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: templateVM
                        name: 'System load'
                -
                  type: GRAPH_CLASSIC
                  x: '12'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '0'
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: templateVM
                        name: 'CPU usage'
                -
                  type: GRAPH_CLASSIC
                  'y': '5'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '0'
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: templateVM
                        name: 'Memory usage'
                -
                  type: GRAPH_CLASSIC
                  x: '12'
                  'y': '5'
                  width: '12'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '0'
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: templateVM
                        name: 'Swap usage'
                -
                  type: GRAPH_PROTOTYPE
                  'y': '10'
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: templateVM
                        name: '{#FSNAME}: Disk space usage'
                -
                  type: GRAPH_PROTOTYPE
                  'y': '15'
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: templateVM
                        name: '{#DEVNAME}: Disk read/write rates'
                -
                  type: GRAPH_PROTOTYPE
                  'y': '20'
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: templateVM
                        name: '{#DEVNAME}: Disk average waiting time'
                -
                  type: GRAPH_PROTOTYPE
                  'y': '25'
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: templateVM
                        name: '{#DEVNAME}: Disk utilization and queue'
                -
                  type: GRAPH_PROTOTYPE
                  'y': '30'
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: templateVM
                        name: 'Interface {#IFNAME}: Network traffic'
      valuemaps:
        -
          uuid: 1e958bf0d36e4d069d17c1f859c3383d
          name: ifOperStatus
          mappings:
            -
              value: '0'
              newvalue: unknown
            -
              value: '1'
              newvalue: notpresent
            -
              value: '2'
              newvalue: down
            -
              value: '3'
              newvalue: lowerlayerdown
            -
              value: '4'
              newvalue: testing
            -
              value: '5'
              newvalue: dormant
            -
              value: '6'
              newvalue: up
        -
          uuid: a9027c2aab264fd9a6f931ddd762f257
          name: 'Linux::Interface protocol types'
          mappings:
            -
              value: '0'
              newvalue: 'from KA9Q: NET/ROM pseudo'
            -
              value: '1'
              newvalue: Ethernet
            -
              value: '2'
              newvalue: 'Experimental Ethernet'
            -
              value: '3'
              newvalue: 'AX.25 Level 2'
            -
              value: '4'
              newvalue: 'PROnet token ring'
            -
              value: '5'
              newvalue: Chaosnet
            -
              value: '6'
              newvalue: 'IEEE 802.2 Ethernet/TR/TB'
            -
              value: '7'
              newvalue: ARCnet
            -
              value: '8'
              newvalue: APPLEtalk
            -
              value: '15'
              newvalue: 'Frame Relay DLCI'
            -
              value: '19'
              newvalue: ATM
            -
              value: '23'
              newvalue: 'Metricom STRIP (new IANA id)'
            -
              value: '24'
              newvalue: 'IEEE 1394 IPv4 - RFC 2734'
            -
              value: '27'
              newvalue: EUI-64
            -
              value: '32'
              newvalue: InfiniBand
            -
              value: '256'
              newvalue: ARPHRD_SLIP
            -
              value: '257'
              newvalue: ARPHRD_CSLIP
            -
              value: '258'
              newvalue: ARPHRD_SLIP6
            -
              value: '259'
              newvalue: ARPHRD_CSLIP6
            -
              value: '260'
              newvalue: 'Notional KISS type'
            -
              value: '264'
              newvalue: ARPHRD_ADAPT
            -
              value: '270'
              newvalue: ARPHRD_ROSE
            -
              value: '271'
              newvalue: 'CCITT X.25'
            -
              value: '272'
              newvalue: 'Boards with X.25 in firmware'
            -
              value: '280'
              newvalue: 'Controller Area Network'
            -
              value: '512'
              newvalue: ARPHRD_PPP
            -
              value: '513'
              newvalue: 'Cisco HDLC'
            -
              value: '516'
              newvalue: LAPB
            -
              value: '517'
              newvalue: 'Digital''s DDCMP protocol'
            -
              value: '518'
              newvalue: 'Raw HDLC'
            -
              value: '519'
              newvalue: 'Raw IP'
            -
              value: '768'
              newvalue: 'IPIP tunnel'
            -
              value: '769'
              newvalue: 'IP6IP6 tunnel'
            -
              value: '770'
              newvalue: 'Frame Relay Access Device'
            -
              value: '771'
              newvalue: 'SKIP vif'
            -
              value: '772'
              newvalue: 'Loopback device'
            -
              value: '773'
              newvalue: 'Localtalk device'
            -
              value: '774'
              newvalue: 'Fiber Distributed Data Interface'
            -
              value: '775'
              newvalue: 'AP1000 BIF'
            -
              value: '776'
              newvalue: 'sit0 device - IPv6-in-IPv4'
            -
              value: '777'
              newvalue: 'IP over DDP tunneller'
            -
              value: '778'
              newvalue: 'GRE over IP'
            -
              value: '779'
              newvalue: 'PIMSM register interface'
            -
              value: '780'
              newvalue: 'High Performance Parallel Interface'
            -
              value: '781'
              newvalue: 'Nexus 64Mbps Ash'
            -
              value: '782'
              newvalue: 'Acorn Econet'
            -
              value: '783'
              newvalue: Linux-IrDA
            -
              value: '784'
              newvalue: 'Point to point fibrechannel'
            -
              value: '785'
              newvalue: 'Fibrechannel arbitrated loop'
            -
              value: '786'
              newvalue: 'Fibrechannel public loop'
            -
              value: '787'
              newvalue: 'Fibrechannel fabric'
            -
              value: '800'
              newvalue: 'Magic type ident for TR'
            -
              value: '801'
              newvalue: 'IEEE 802.11'
            -
              value: '802'
              newvalue: 'IEEE 802.11 + Prism2 header'
            -
              value: '803'
              newvalue: 'IEEE 802.11 + radiotap header'
            -
              value: '804'
              newvalue: ARPHRD_IEEE802154
            -
              value: '805'
              newvalue: 'IEEE 802.15.4 network monitor'
            -
              value: '820'
              newvalue: 'PhoNet media type'
            -
              value: '821'
              newvalue: 'PhoNet pipe header'
            -
              value: '822'
              newvalue: 'CAIF media type'
            -
              value: '823'
              newvalue: 'GRE over IPv6'
            -
              value: '824'
              newvalue: 'Netlink header'
            -
              value: '825'
              newvalue: 'IPv6 over LoWPAN'
            -
              value: '826'
              newvalue: 'Vsock monitor header'
        -
          uuid: 5bec8fd20adf47de90209ad67b5985e9
          name: zabbix.host.available
          mappings:
            -
              value: '0'
              newvalue: 'not available'
            -
              value: '1'
              newvalue: available
            -
              value: '2'
              newvalue: unknown
        -
          uuid: cdfadd0edd33435b9d97e80fae75a0ed
          name: 'Zabbix agent ping status'
          mappings:
            -
              value: '1'
              newvalue: Up
  triggers:
    -
      uuid: 647f8be557344f52a20e4d6c47cfe2a1
      expression: 'last(/templateVM/proc.num)/last(/templateVM/kernel.maxproc)*100>80'
      name: 'Getting closer to process limit'
      event_name: 'Getting closer to process limit (over 80% used)'
      opdata: '{ITEM.LASTVALUE1} active, {ITEM.LASTVALUE2} limit.'
      priority: WARNING
      tags:
        -
          tag: scope
          value: performance
    -
      uuid: 4940359265a943fc8f626299253417da
      expression: 'max(/templateVM/system.swap.size[,pfree],5m)<{$SWAP.PFREE.MIN.WARN} and last(/templateVM/system.swap.size[,total])>0'
      name: 'High swap space usage'
      event_name: 'High swap space usage (less than {$SWAP.PFREE.MIN.WARN}% free)'
      opdata: 'Free: {ITEM.LASTVALUE1}, total: {ITEM.LASTVALUE2}'
      priority: WARNING
      description: 'This trigger is ignored, if there is no swap configured.'
      dependencies:
        -
          name: 'High memory utilization'
          expression: 'min(/templateVM/vm.memory.utilization,5m)>{$MEMORY.UTIL.MAX}'
        -
          name: 'Lack of available memory'
          expression: 'max(/templateVM/vm.memory.size[available],5m)<{$MEMORY.AVAILABLE.MIN} and last(/templateVM/vm.memory.size[total])>0'
      tags:
        -
          tag: scope
          value: capacity
    -
      uuid: f96a4a1ec2f8420b85c2b670074ace9c
      expression: 'max(/templateVM/vm.memory.size[available],5m)<{$MEMORY.AVAILABLE.MIN} and last(/templateVM/vm.memory.size[total])>0'
      name: 'Lack of available memory'
      event_name: 'Lack of available memory (<{$MEMORY.AVAILABLE.MIN} of {ITEM.VALUE2})'
      opdata: 'Available: {ITEM.LASTVALUE1}, total: {ITEM.LASTVALUE2}'
      priority: AVERAGE
      tags:
        -
          tag: scope
          value: capacity
        -
          tag: scope
          value: performance
    -
      uuid: 7eb2ae736d43488989178b0e54c53793
      expression: |
        min(/templateVM/system.cpu.load[all,avg1],5m)/last(/templateVM/system.cpu.num)>{$LOAD_AVG_PER_CPU.MAX.WARN}
        and last(/templateVM/system.cpu.load[all,avg5])>0
        and last(/templateVM/system.cpu.load[all,avg15])>0
      name: 'Load average is too high'
      event_name: 'Load average is too high (per CPU load over {$LOAD_AVG_PER_CPU.MAX.WARN} for 5m)'
      opdata: 'Load averages(1m 5m 15m): ({ITEM.LASTVALUE1} {ITEM.LASTVALUE3} {ITEM.LASTVALUE4}), # of CPUs: {ITEM.LASTVALUE2}'
      priority: AVERAGE
      description: 'Per CPU load average is too high. Your system may be slow to respond.'
      tags:
        -
          tag: scope
          value: capacity
        -
          tag: scope
          value: performance
  graphs:
    -
      uuid: 21c782260d214acfae346c0d9167a5d9
      name: 'CPU jumps'
      graph_items:
        -
          color: 1A7C11
          item:
            host: templateVM
            key: system.cpu.switches
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: templateVM
            key: system.cpu.intr
    -
      uuid: 7a69ff9fa0f940278181015850fa2357
      name: 'CPU usage'
      type: STACKED
      ymin_type_1: FIXED
      ymax_type_1: FIXED
      graph_items:
        -
          color: 1A7C11
          item:
            host: templateVM
            key: 'system.cpu.util[,system]'
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: templateVM
            key: 'system.cpu.util[,user]'
        -
          sortorder: '2'
          color: F63100
          item:
            host: templateVM
            key: 'system.cpu.util[,nice]'
        -
          sortorder: '3'
          color: A54F10
          item:
            host: templateVM
            key: 'system.cpu.util[,iowait]'
        -
          sortorder: '4'
          color: FC6EA3
          item:
            host: templateVM
            key: 'system.cpu.util[,steal]'
        -
          sortorder: '5'
          color: 6C59DC
          item:
            host: templateVM
            key: 'system.cpu.util[,interrupt]'
        -
          sortorder: '6'
          color: AC8C14
          item:
            host: templateVM
            key: 'system.cpu.util[,softirq]'
        -
          sortorder: '7'
          color: 611F27
          item:
            host: templateVM
            key: 'system.cpu.util[,guest]'
        -
          sortorder: '8'
          color: F230E0
          item:
            host: templateVM
            key: 'system.cpu.util[,guest_nice]'
    -
      uuid: c3c00788dcd44a799d3f003f73ce66c3
      name: 'CPU utilization'
      ymin_type_1: FIXED
      ymax_type_1: FIXED
      graph_items:
        -
          drawtype: GRADIENT_LINE
          color: 1A7C11
          item:
            host: templateVM
            key: system.cpu.util
    -
      uuid: d20fadc9aa1d4425b7ce8a0a3d5fd03b
      name: 'Memory usage'
      ymin_type_1: FIXED
      graph_items:
        -
          drawtype: BOLD_LINE
          color: 1A7C11
          item:
            host: templateVM
            key: 'vm.memory.size[total]'
        -
          sortorder: '1'
          drawtype: GRADIENT_LINE
          color: 2774A4
          item:
            host: templateVM
            key: 'vm.memory.size[available]'
    -
      uuid: 034d1e07ea7f46f59d6cd4e69015b2f7
      name: 'Memory utilization'
      ymin_type_1: FIXED
      ymax_type_1: FIXED
      graph_items:
        -
          drawtype: GRADIENT_LINE
          color: 1A7C11
          item:
            host: templateVM
            key: vm.memory.utilization
    -
      uuid: d2a5803ce2074cdfa4d080340476e239
      name: Processes
      graph_items:
        -
          color: 1A7C11
          item:
            host: templateVM
            key: proc.num
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: templateVM
            key: 'proc.num[,,run]'
        -
          sortorder: '2'
          color: F63100
          item:
            host: templateVM
            key: kernel.maxproc
    -
      uuid: d8c9f20db4f04d8cb68e18b71050ae0e
      name: 'Swap usage'
      graph_items:
        -
          color: 1A7C11
          item:
            host: templateVM
            key: 'system.swap.size[,free]'
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: templateVM
            key: 'system.swap.size[,total]'
    -
      uuid: 0c98c3fee6e142dda8dad83d5687bbb4
      name: 'System load'
      ymin_type_1: FIXED
      graph_items:
        -
          color: 1A7C11
          item:
            host: templateVM
            key: 'system.cpu.load[all,avg1]'
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: templateVM
            key: 'system.cpu.load[all,avg5]'
        -
          sortorder: '2'
          color: F63100
          item:
            host: templateVM
            key: 'system.cpu.load[all,avg15]'
        -
          sortorder: '3'
          color: A54F10
          yaxisside: RIGHT
          item:
            host: templateVM
            key: system.cpu.num
